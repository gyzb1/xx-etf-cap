# ç‰ˆæœ¬å†å²

## v1.3.0-dynamic (2024-12-08)

### ğŸ¯ é‡å¤§æ›´æ–°ï¼šåŠ¨æ€è°ƒä»“å›æµ‹

**æ–°å¢åŠŸèƒ½**ï¼š
- âœ¨ **åŠ¨æ€è°ƒä»“å›æµ‹API** (`/api/backtest-dynamic`)
  - è‡ªåŠ¨è¯†åˆ«æ‰€æœ‰å†å²æŠ¥å‘ŠæœŸï¼ˆä¸­æŠ¥/å¹´æŠ¥ï¼‰
  - è·Ÿéš512890æŒä»“å˜åŒ–è‡ªåŠ¨è°ƒä»“
  - æ¯ä¸ªæŒä»“æœŸç‹¬ç«‹è®¡ç®—åŒå› å­æƒé‡
  - ç”Ÿæˆè¿ç»­çš„å‡€å€¼æ›²çº¿

- ğŸ¨ **åŠ¨æ€è°ƒä»“Webç•Œé¢** (`/dynamic.html`)
  - ç°ä»£åŒ–çš„UIè®¾è®¡
  - å®æ—¶å±•ç¤ºè°ƒä»“å‘¨æœŸè¯¦æƒ…
  - å¯è§†åŒ–å‡€å€¼æ›²çº¿å¯¹æ¯”
  - å“åº”å¼å¸ƒå±€æ”¯æŒç§»åŠ¨ç«¯

- ğŸ“ **å®Œæ•´æ–‡æ¡£**
  - `DYNAMIC_REBALANCING.md` - åŠ¨æ€è°ƒä»“è¯¦ç»†è¯´æ˜
  - `QUICKSTART.md` - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹æŒ‡å—
  - `test-dynamic.js` - å‘½ä»¤è¡Œæµ‹è¯•è„šæœ¬

**æŠ€æœ¯æ”¹è¿›**ï¼š
- ä¼˜åŒ–æŒä»“æœŸç­›é€‰é€»è¾‘
- æ”¹è¿›æŠ¥å‘ŠæœŸè¯†åˆ«ç®—æ³•
- æ”¯æŒè·¨å¹´åº¦æŒä»“æ•°æ®
- ç¬¬ä¸€ä¸ªæŒä»“æœŸä»ç”¨æˆ·æŒ‡å®šæ—¥æœŸå¼€å§‹

**ç¤ºä¾‹ç»“æœ**ï¼ˆ2024å¹´å…¨å¹´ï¼‰ï¼š
- è°ƒä»“æ¬¡æ•°ï¼š2æ¬¡ï¼ˆ2023å¹´æŠ¥ â†’ 2024ä¸­æŠ¥ï¼‰
- æ¶‰åŠè‚¡ç¥¨ï¼š171åªï¼ˆå»é‡ï¼‰
- ç»„åˆæ”¶ç›Šï¼š9.48%
- ETFæ”¶ç›Šï¼š20.54%

**æ–‡ä»¶å˜æ›´**ï¼š
- `server.js` - æ–°å¢åŠ¨æ€è°ƒä»“APIç«¯ç‚¹
- `public/dynamic.html` - æ–°å¢åŠ¨æ€è°ƒä»“å‰ç«¯é¡µé¢
- `test-dynamic.js` - æ–°å¢æµ‹è¯•è„šæœ¬
- `README.md` - æ›´æ–°æ–‡æ¡£
- `DYNAMIC_REBALANCING.md` - æ–°å¢åŠŸèƒ½æ–‡æ¡£
- `QUICKSTART.md` - æ–°å¢å¿«é€Ÿå¼€å§‹æŒ‡å—

---

# ç‰ˆæœ¬å†å²

## v1.0.0 - ç¨³å®šç‰ˆæœ¬ (2024-12-04)

**è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æµ‹è¯•é€šè¿‡çš„ç¨³å®šç‰ˆæœ¬**

### ä¸»è¦åŠŸèƒ½
- âœ… åŒå› å­åŠ æƒæ¨¡å‹ï¼ˆè‚¡æ¯ç‡ + ROCEï¼‰
- âœ… è‡ªåŠ¨è·å–512890 ETFæŒä»“ï¼ˆçº¦84åªè‚¡ç¥¨ï¼‰
- âœ… æ™ºèƒ½æ•°æ®å¤„ç†å’Œç¼ºå¤±å€¼å¡«å……
- âœ… å‡€å€¼æ›²çº¿å½’ä¸€åŒ–å¯¹æ¯”ï¼ˆåˆå§‹å€¼éƒ½æ˜¯1.0ï¼‰
- âœ… å®Œæ•´çš„READMEæ–‡æ¡£ï¼Œè¯¦ç»†è¯´æ˜è®¡ç®—è§„åˆ™
- âœ… ç®€åŒ–çš„Webç•Œé¢ï¼ˆä»…ä¿ç•™ETFç­–ç•¥ï¼‰

### å¦‚ä½•å›åˆ°è¿™ä¸ªç‰ˆæœ¬

å¦‚æœåç»­ä¿®æ”¹å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å›åˆ°è¿™ä¸ªç¨³å®šç‰ˆæœ¬ï¼š

#### æ–¹æ³•1ï¼šä½¿ç”¨Gitæ ‡ç­¾ï¼ˆæ¨èï¼‰
```bash
# æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾
git tag -l

# å›åˆ°v1.0.0ç‰ˆæœ¬
git checkout v1.0.0

# å¦‚æœè¦åŸºäºè¿™ä¸ªç‰ˆæœ¬åˆ›å»ºæ–°åˆ†æ”¯ç»§ç»­å¼€å‘
git checkout -b fix-from-v1.0.0 v1.0.0

# å¦‚æœè¦å®Œå…¨é‡ç½®åˆ°è¿™ä¸ªç‰ˆæœ¬ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œä¼šä¸¢å¤±åç»­ä¿®æ”¹ï¼‰
git reset --hard v1.0.0
```

#### æ–¹æ³•2ï¼šä½¿ç”¨æäº¤å“ˆå¸Œ
```bash
# æŸ¥çœ‹æäº¤å†å²
git log --oneline

# å›åˆ°ç‰¹å®šæäº¤
git checkout 14017ad

# æˆ–è€…é‡ç½®åˆ°è¿™ä¸ªæäº¤
git reset --hard 14017ad
```

#### æ–¹æ³•3ï¼šä»GitHubæ¢å¤
```bash
# ä»è¿œç¨‹ä»“åº“é‡æ–°æ‹‰å–v1.0.0ç‰ˆæœ¬
git fetch origin
git checkout tags/v1.0.0
```

### æ ¸å¿ƒæ–‡ä»¶åˆ—è¡¨
- `server.js` - åç«¯æœåŠ¡å™¨ï¼ˆ870è¡Œï¼‰
- `public/index.html` - å‰ç«¯é¡µé¢ï¼ˆå®Œæ•´ç‰ˆï¼‰
- `README.md` - è¯¦ç»†æ–‡æ¡£ï¼ˆçº¦300è¡Œï¼‰
- `package.json` - ä¾èµ–é…ç½®
- `.gitignore` - Gitå¿½ç•¥è§„åˆ™

### æŠ€æœ¯ç»†èŠ‚
- Node.js + Express
- Tushare Pro API
- Chart.js å¯è§†åŒ–
- æ‰¹é‡å¤„ç†ï¼šå†å²æ•°æ®10åª/æ‰¹ï¼Œè´¢åŠ¡æ•°æ®8åª/æ‰¹
- æ‰¹æ¬¡å»¶è¿Ÿï¼š500ms

### å·²çŸ¥é—®é¢˜
- éƒ¨åˆ†è‚¡ç¥¨çš„è‚¡æ¯ç‡å¯èƒ½ä¸º0ï¼ˆçœŸå®æƒ…å†µï¼Œæœªåˆ†çº¢ï¼‰
- éƒ¨åˆ†è‚¡ç¥¨çš„ROCEå¯èƒ½ç¼ºå¤±ï¼ˆä½¿ç”¨å¹³å‡å€¼å¡«å……ï¼‰
- APIé¢‘ç‡é™åˆ¶å¯èƒ½å¯¼è‡´å›æµ‹æ—¶é—´è¾ƒé•¿ï¼ˆ1-2åˆ†é’Ÿï¼‰

---

## v1.1.0 - ä¿®å¤é‡‘èä¼ä¸šROCEè®¡ç®— (2024-12-04)

**é‡è¦æ›´æ–°ï¼šä¿®å¤äº†é“¶è¡Œç­‰é‡‘èä¼ä¸šçš„ROCEè®¡ç®—é—®é¢˜**

### ä¸»è¦æ”¹è¿›

#### 1. é‡‘èä¼ä¸šROCEè®¡ç®—ä¿®å¤ âœ…
- **é—®é¢˜**ï¼šé“¶è¡Œã€ä¿é™©ç­‰é‡‘èä¼ä¸šçš„èµ„äº§è´Ÿå€ºè¡¨ä¸­ `total_cur_liab`ï¼ˆæµåŠ¨è´Ÿå€ºï¼‰ä¸º null
- **åŸå› **ï¼šé‡‘èä¼ä¸šçš„èµ„äº§è´Ÿå€ºè¡¨ç»“æ„ä¸æ™®é€šä¼ä¸šä¸åŒï¼Œæ²¡æœ‰"æµåŠ¨è´Ÿå€º"æ¦‚å¿µ
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  ```
  æ™®é€šä¼ä¸šï¼šèµ„æœ¬ä½¿ç”¨ = æ€»èµ„äº§ - æµåŠ¨è´Ÿå€º
  é‡‘èä¼ä¸šï¼šèµ„æœ¬ä½¿ç”¨ = è‚¡ä¸œæƒç›Š (total_hldr_eqy_exc_min_int)
  ```
- **ç»“æœ**ï¼šæ‰€æœ‰84åªè‚¡ç¥¨ï¼ˆåŒ…æ‹¬é“¶è¡Œè‚¡ï¼‰éƒ½èƒ½æ­£ç¡®è®¡ç®—ROCE

#### 2. åˆ©æ¶¦æŒ‡æ ‡ä¸‰çº§å›é€€æœºåˆ¶ âœ…
- **ä¼˜å…ˆçº§**ï¼š`ebit` â†’ `operate_profit` â†’ `total_profit`
- **é€‚ç”¨åœºæ™¯**ï¼š
  - æ™®é€šä¼ä¸šï¼šä½¿ç”¨EBITï¼ˆæ¯ç¨å‰åˆ©æ¶¦ï¼‰
  - é‡‘èä¼ä¸šï¼šEBITé€šå¸¸ä¸ºnullï¼Œè‡ªåŠ¨ä½¿ç”¨è¥ä¸šåˆ©æ¶¦æˆ–åˆ©æ¶¦æ€»é¢
- **æ—¥å¿—æç¤º**ï¼šä¼šæ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªåˆ©æ¶¦æŒ‡æ ‡

#### 3. APIè°ƒç”¨ä¼˜åŒ– âœ…
- ç§»é™¤å›ºå®šæŠ¥å‘ŠæœŸé™åˆ¶ï¼Œè‡ªåŠ¨è·å–æœ€æ–°è´¢æŠ¥æ•°æ®
- ä¼˜åŒ–æ‰¹å¤„ç†å¤§å°ï¼š
  - å†å²æ•°æ®ï¼š10åª/æ‰¹
  - å› å­æ•°æ®ï¼š5åª/æ‰¹ï¼ˆé™ä½ä»¥é¿å…APIé™æµï¼‰
- æ‰¹æ¬¡é—´å»¶è¿Ÿå¢åŠ åˆ°800ms

#### 4. æ•°æ®å¤„ç†æ”¹è¿› âœ…
- ç§»é™¤ROCEå¡«å……é€»è¾‘ï¼šç¼ºå¤±æ•°æ®æ˜¾ç¤ºä¸º"-"ï¼Œä¸å‚ä¸æƒé‡è®¡ç®—
- åªæœ‰åŒæ—¶å…·å¤‡è‚¡æ¯ç‡å’ŒROCEçš„è‚¡ç¥¨æ‰å‚ä¸åŒå› å­åŠ æƒ
- æ·»åŠ è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•

#### 5. æ–‡æ¡£å®Œå–„ âœ…
- READMEä¸­è¯¦ç»†è¯´æ˜é‡‘èä¼ä¸šç‰¹æ®Šå¤„ç†é€»è¾‘
- åˆ—å‡ºæ‰€æœ‰ä½¿ç”¨çš„Tushareå­—æ®µå
- è¯´æ˜ROCEè®¡ç®—çš„ä¸‰çº§å›é€€æœºåˆ¶

### æ–°å¢æ–‡ä»¶
- `test-bank.js` - é“¶è¡Œè‚¡æ•°æ®è·å–æµ‹è¯•å·¥å…·
- `VERSION_HISTORY.md` - ç‰ˆæœ¬å†å²è®°å½•

### æŠ€æœ¯ç»†èŠ‚
```javascript
// èµ„äº§è´Ÿå€ºè¡¨å­—æ®µ
fields: 'ts_code,end_date,total_assets,total_cur_liab,total_hldr_eqy_exc_min_int'

// é‡‘èä¼ä¸šåˆ¤æ–­é€»è¾‘
if (!currentLiab && equityIdx >= 0) {
  const totalEquity = balanceData.items[0][equityIdx];
  if (totalEquity) {
    currentLiab = totalAssets - totalEquity;
    console.log(`${code} using total equity method (financial company)`);
  }
}
```

### å¦‚ä½•ä»v1.0.0å‡çº§
```bash
git pull origin main
npm install  # å¦‚æœæœ‰ä¾èµ–æ›´æ–°
```

### å·²çŸ¥æ”¹è¿›
- æ‰€æœ‰è‚¡ç¥¨éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºROCEï¼ˆé™¤éçœŸçš„æ²¡æœ‰è´¢æŠ¥æ•°æ®ï¼‰
- é“¶è¡Œè‚¡ä¸å†æ˜¾ç¤º"-"
- æƒé‡åˆ†é…æ›´åŠ åˆç†

---
